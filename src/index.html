<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="imagens/logo.png">
    <link rel="stylesheet" href="css/style.css">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia do Bairro</title>
    <style>
        /* estilo m√≠nimo para o mapa */
        #map { height: 400px; width: 100%; border-radius: 6px; }
    </style>
</head>
<body>

    <header>
       <div class="logo">Guia do Bairro</div>
        <button class="btn-menu" aria-label="Abrir Menu">‚ò∞</button>
        <form class="pesquisa" action="catalogo.html" method="GET">
            <input type="text" name="q" placeholder="Buscar no site...">
            <button type="submit">üîç</button>
        </form>
        <ul class="navegacao">
            <li><a href="index.html">P√°gina Inicial</a></li>
            <li><a href="catalogo.html">Cat√°logo</a></li>
            <li><a href="registrocomercio.html">Registrar Com√©rcio</a></li>
        </ul>
    </header>
    
    <main>
        <section aria-label="Mapa de neg√≥cios locais" id="lista-estabelecimentos-index"> 
            <h1>Mapa</h1>
            <div id="map" role="application" aria-label="Mapa interativo com estabelecimentos"></div>
            
            <aside class="card-comercio" data-categoria="alimentacao"> 
                <h1>Padaria do Jo√£o</h1>
                <div>Categoria: Alimenta√ß√£o</div>
                <p>P√£es fresquinhos todos os dias, atendimento r√°pido e pre√ßos justos.</p>
                <a href="padaria.html"> <button>Ver P√°gina Completa</button></a>
            </aside>
            
            <aside class="card-comercio" data-categoria="outros">
                <h1>Oficina Mec√¢nica Souza</h1>
                <div>Categoria: Outros</div>
                <p>Especializada em manuten√ß√£o de ve√≠culos.</p>
                <a href="oficina.html"> <button>Ver P√°gina Completa</button></a>
            </aside>
        </section>

        <section aria-label="Categorias">
            <h3>Categorias</h3>
            <div class="categorias" id="botoes-categoria">
                <button data-categoria="alimentacao">üçî Alimenta√ß√£o</button>
                <button data-categoria="saude">‚ù§Ô∏è Sa√∫de e Bem-Estar</button>
                <button data-categoria="domesticos">üè† Servi√ßos Dom√©sticos</button>
                <button data-categoria="educacao">üìö Educa√ß√£o</button>
                <button data-categoria="outros">‚öôÔ∏è Outros</button>
                <button data-categoria="todos" id="btn-todos">‚ú® Todos</button> 
            </div>
        </section>
    </main>
    
    <footer class="rodape">
        <nav>
            <a href="sobre.html">Sobre</a> |
            <a href="ajuda.html">Ajuda</a> |
            <a href="politicadeprivacidade.html">Pol√≠tica de Privacidade</a>
        </nav>
    </footer>
    <script src="js/main.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Inicializa o mapa centrado em Umuarama - PR e adiciona dois marcadores com endere√ßos aleat√≥rios
        document.addEventListener('DOMContentLoaded', function() {
            // Coordenadas aproximadas de Umuarama
            const center = [-23.7570, -53.3200];
            const map = L.map('map').setView(center, 14);

            // Camada de tiles (OpenStreetMap)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
            }).addTo(map);
            // Dois estabelecimentos de exemplo em Umuarama - PR
            const exemplos = [
                { nome: 'Padaria Central', endereco: 'R. Aleat√≥ria, 123 - Centro, Umuarama - PR', coords: [-23.7535, -53.3190] },
                { nome: 'Oficina do Jo√£o', endereco: 'Av. Exemplo, 456 - Jardim Novo, Umuarama - PR', coords: [-23.7600, -53.3250] }
            ];

            // Fun√ß√£o para adicionar marcador e manter lista de bounds
            const bounds = [];
            function adicionarMarcador(item, isSaved) {
                const marker = L.marker(item.coords).addTo(map);
                const popup = '<strong>' + (item.nome || 'Sem nome') + '</strong>' + (item.endereco ? ('<br>' + item.endereco) : '') + (item.categoria ? ('<br><em>' + item.categoria + '</em>') : '') + (isSaved ? '<br><small>Registrado</small>' : '');
                marker.bindPopup(popup);
                bounds.push(item.coords);
            }

            // Adiciona exemplos
            exemplos.forEach(e => adicionarMarcador(e, false));

            // Carrega comercios salvos no localStorage
            try {
                const salvos = JSON.parse(localStorage.getItem('comercios') || '[]');
                if (Array.isArray(salvos)) {
                    salvos.forEach(c => {
                        if (c && c.coords && c.coords.length === 2) adicionarMarcador({ nome: c.nome, endereco: c.endereco, categoria: c.categoria, coords: c.coords }, true);
                    });
                }
            } catch (err) {
                console.warn('Erro ao ler comercios do localStorage', err);
            }

            // Ajusta view para incluir todos os marcadores, se houver
            if (bounds.length) {
                const latlngs = bounds.map(b => L.latLng(b[0], b[1]));
                const bb = L.latLngBounds(latlngs);
                map.fitBounds(bb.pad(0.25));
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            // Pega todos os bot√µes de categoria que t√™m o atributo data-categoria
            const botoesCategoria = document.querySelectorAll('#botoes-categoria button');
            const urlCatalogo = 'catalogo.html';

            botoesCategoria.forEach(botao => {
                botao.addEventListener('click', function() {
                    const categoria = botao.getAttribute('data-categoria');
                    
                    let urlRedirecionamento;

                    if (categoria === 'todos') {
                        // Se for 'Todos', redireciona para o cat√°logo sem filtro
                        urlRedirecionamento = urlCatalogo;
                    } else {
                        // Redireciona para o cat√°logo com o filtro da categoria
                        // Usamos 'cat=' para que o catalogo.html saiba que √© um filtro de categoria.
                        urlRedirecionamento = urlCatalogo + '?cat=' + categoria;
                    }
                    
                    // Redireciona a p√°gina atual para o cat√°logo
                    window.location.href = urlRedirecionamento;
                });
            });
        });
    </script>
</body>
</html>
